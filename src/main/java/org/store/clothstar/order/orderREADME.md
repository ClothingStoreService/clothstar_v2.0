# order 패키지 README

## 패키지 개요

이 패키지는 주문에 대한 기능을 구현하기 위한 패키지이다(v1).

### 주문 조회 설계안

1. 주문 조회
   1-1. 조회되는 주문 정보
    - 주문번호, 회원번호, 배송지번호, 주문생성일, 주문상태, 총 배송비, 총 상품금액, 결제수단, 총 결제금액
2. 구매 확정 시(구매자가 구매 확정을 하는 경우)
    - 주문상태가 '구매확정'으로 변경됨

### 주문 & 주문상세 생성 설계안

1. 주문 생성
   1-1. 생성되는 주문 정보
    - 주문번호, 회원번호, 배송지번호, 주문생성일, 주문상태, 총 배송비, 총 상품금액, 결제수단, 총 결제금액

    * 총 배송비 = 3000원으로 고정
    * 총 상품금액 = 0원으로 고정
    * 총 결제금액 = 0원으로 고정
    * 결제수단 종류
        - [ 신용/체크카드, 네이버페이, 카카오페이, 무통장 입금 ]
    * 주문상태 단계
        - [ 승인대기(WAITING) -> 주문승인(APPROVE) -> 배송완료(DELIVERED) -> 구매확정(CONFIRM) ]
        - [ 승인대기(WAITING) -> 주문취소(CANCEL) ]
2. 주문상세 생성
   2-1. 생성되는 주문상세 정보:
   주문상세번호, 주문번호, 상품번호, 상품옵션번호, 구매수량, 고정가격, 상품 종류 하나당 총 가격, 상품명, 재고, 옵션명, 추가비용, 브랜드명
    - 주문 유효성 검사: 구매 수량이 재고보다 크면 주문이 생성되지 않음
    - 상품 재고 차감: 주문상세 생성 시, 구매 수량만큼 상품 재고 차감
    - 주문과 주문상세 생성은 하나의 트랜잭션으로 이루어짐

    * 총 상품금액 = 주문의 총 상품금액 + 주문상세의, 상품 종류 하나당 총 금액
    * 총 결제금액 = 주문의 총 상품금액 + 주문상세의, 상품 종류 하나당 총 금액 + 주문의 총 배송비
3. 주문상세 추가
    - 처음 주문과 주문상세가 생성되면, 이후에는 주문에 주문상세를 추가하는 형식으로 진행됨

### (판매자) 주문 관리 설계안

1. 주문 리스트 조회: 주문 상태가 [승인대기]인 주문 리스트 조회
2. 주문 승인 또는 취소
    - 주문 승인 시, 주문 상태가 [승인대기] 에서 [주문승인] 으로 변경됨
    - 주문 취소 시, 주문 상태가 [승인대기] 에서 [주문취소] 로 변경됨

### API 디자인

- 주문 조회: GET /v1/orders/{orderId}

- 구매 확정: PATCH /v1/orders/{orderId}
    * 프로세스
        1. 유효성검사: 주문상태가 [배송완료]인지 확인
        2. 유효시, 주문상태를 [구매확정]으로 변경

- 주문 생성: POST /v1/orders
    * 프로세스
        1. 주문 생성
        2. 주문상세 생성
            * 주문-주문상세 생성은 하나의 트랜잭션임

- 주문상세 추가: POST /v1/orderdetails
    * 프로세스
        1. 유효성검사: 주문 수량이 상품 재고보다 클 경우, 주문이 생성되지 않음
        2. 주문 정보 업데이트: 주문상세 추가에 따른, 주문의 총 상품 금액과 총 결제 금액 업데이트
        3. 주문 수량만큼 상품 재고 차감

- (판매자) 주문 관리 :
    - 승인대기 주문 리스트 조회: GET /v1/seller/orders
    - 주문 승인 및 취소: PATCH /v1/seller/orders/{orderId}
        * 프로세스
            1. 유효성 검사: 주문상태가 [승인대기]인지 확인
               2-1. 유효시, 'APPROVE'가 요청되면 주문상태를 [주문승인]으로 변경
               2-2. 유효시, 'CANCEL'이 요청되면 주문상태를 [주문취소]로 변경
